<html>
<head>
<title>My JSP 'hello.jsp' starting page</title>
<script src="js/jquery.js" type="text/javascript">
</script>
 <style>
		.view {
            width: 300px;
            height: 300px;
            overflow: hidden;
        }
    
        .img {
            width: 100%;
            height: 100%;
        }
         */
    </style>
</head>
<body>
	<div id="wrap">
		<form enctype="multipart/form-data" id="uploadForm">
		<div id='groupdiv'>
			<input type="file" name="uploadFile" id='uploadfile'> 
				<div id='preview'></div>
				<input type="button"
				id='delgroup' value="删除" >
				
		</div>
		<input type="button"
				id="newgroup" value="新增">
	
		<input type="button"
				id="uploadPicButton" value="上传" onclick="uploadPic()">
		</form>
	</div>

</body>
<script type="text/javascript">
divCnt=1;
$('#delgroup').click(function(e){
	if(divCnt>1){
		$(this).closest('div').remove();
		divCnt-=1;
	}else{
		$a=$(this).closest('div')
		$a.find(':file').val('');
		$a.find('#preview').empty();
		$a.find('#preview').removeClass();
	}
	 
	});
$('#newgroup').click(function(e){
    $(this).prev('div').after($clonediv.clone(true));
    divCnt+=1;
  
});
$("[name='uploadFile']").change(function(e){
    var file = e.target.files[0];
    $this=$(this);
    var img = new Image();
    url = img.src=URL.createObjectURL(file);
    var $img = $(img);
    $img.addClass("img");
    img.onload = function(e){
        URL.revokeObjectURL(url);
    	$div=$this.next('#preview');
        $div.addClass("view");
    	$div.empty().append($img);
    }
});
$clonediv=$('#groupdiv').clone(true);
function uploadPic(){
	var fileList=[];
   /*  var pic = $('#upload_file')[0].files[0];*/ 
   
    var fd = new FormData();
    $(':file').each(function(){
    	fd.append('file', $(this)[0].files[0]);
    })
    
    fd.append('description','new file');
    $.ajax({
    	url:'hello/upload.action',
        type:"post",
        // Form数据
        data: fd,
        cache: false,
        contentType: false,
        processData: false,
        success:function(data){
            alert("成功");
        }
    });
                    
}
</script>
</html>